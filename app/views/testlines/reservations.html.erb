<% isInit = true %>
<main class="wrapper">
	<article>
		<% reserve1 = firstReserve; %>
		<% if reserve1 == 0 %>
			<div class="wrapper-greeting">
				<div class="alert alert-success alert-dismissible">
					<h4 class="alert-heading">There are no reservations.</h4>
				</div>
			</div>
		<% else %>
		<aside class="sidenav">
			<% @testlines.each do |testline| %>
				<% if ( testline.reservations.count !=0) %>
					<a href="" class="closebtn">
						<i class="fa fa-times"></i>
					</a>
					<% if testline.id == reserve1 %>
						<a href="javascript:void(0)" class="tablinks active" onclick="openReservation(event, '<%= testline.id %>')">
					<% else %>
						<a href="javascript:void(0)" class="tablinks" onclick="openReservation(event, '<%= testline.id %>')">
					<% end %>
						<i class="fa fa-server"></i>
						<%= testline.name %>
					</a>
				<% end %>
			<% end %>
		</aside>

		<% @testlines.each do |testline| %>
			<% if testline.id == reserve1 %>
				<section id="<%= testline.id %>" class="tabcontent" style="display: block;">
			<% else %>
				<section id="<%= testline.id %>" class="tabcontent" style="display: none;">
			<% end %>
					<h2 style="color: #2c3e50;">
						<i class="fa fa-navicon sidenav-toggle"></i> 
						In queue for <%= testline.name %>
					</h2>
					<ul>
						<% currentReserve = 0 %>
						<% @reservations.each do |reserve| %>
							<% if testline.id == reserve.testline_id %>
								<li class="list-item">
									<h3 class="title"><%=reserve.name%></h3>
									<% if currentReserve == 0 %>
										<small class="badge badge-current">Current</small>
									<% elsif currentReserve == 1 %>
										<small class="badge badge-next">Next in line</small>
									<% else %>
										<small class="badge badge-pending">Pending</small>
									<% end %>
									<p class="subtitle"><%=reserve.description%>.</p>
									<p class="description">Reserved for <b><%=reserve.team_name%></b> by <%=reserve.email%> on <%= reserve.created_at.localtime.to_s(:db) %></p>
									<% if current_user.email == reserve.email || current_user.isAdmin? %>
										<% if currentReserve == 0 %>
											<div class="modal-as" id="-<%= reserve.id %>">
												<div class="modal-content-as" style="max-width: 400px;">
													<div class="modal-header-as bg-red">
														<h4 class="modal-title-as"><i class="fa fa-trash"></i> Release</h4>
														<button type="button" class="modal-close-as bg-red" onclick="deactivate_modal(-<%= reserve.id %>)">&times;</button>
													</div>
													<div class="modal-body-as">
														<p class="modal-text">Are you sure you want to release this testline? Releasing may take a while. Please wait.</p>
													</div>
													<div class="modal-footer-as">
														<%= link_to 'Yes', [reserve.testline,reserve], method: :delete, :class => "modal-btn-as bg-red" %>
														<button type="button" class="modal-btn-as" onclick="deactivate_modal(-<%= reserve.id %>)">No</button>
													</div>
												</div>
											</div>
											<%= content_tag :a, '<i class="fa fa-times"></i> Release'.html_safe,:onclick => "activate_modal(-#{reserve.id})", :class=>"release", :style => "cursor: pointer;" %>
										<% else %>

											<div class="modal-as" id="-<%= reserve.id %>">
												<div class="modal-content-as" style="max-width: 400px;">
													<div class="modal-header-as bg-red">
														<h4 class="modal-title-as"><i class="fa fa-trash"></i> Cancel</h4>
														<button type="button" class="modal-close-as bg-red" onclick="deactivate_modal(-<%= reserve.id %>)">&times;</button>
													</div>
													<div class="modal-body-as">
														<p class="modal-text">Are you sure you want to cancel your reservation?</p>
													</div>
													<div class="modal-footer-as">
														<%= link_to 'Yes', [reserve.testline,reserve], method: :delete, :class => "modal-btn-as bg-red" %>
														<button type="button" class="modal-btn-as" onclick="deactivate_modal(-<%= reserve.id %>)">No</button>
													</div>
												</div>
											</div>

											<%= content_tag :a, '<i class="fa fa-times"></i> Cancel'.html_safe,:onclick => "activate_modal(-#{reserve.id})", :class=>"release", :style => "cursor: pointer;" %>
										<% end %>
									<% end %>
								</li>
								<% currentReserve += 1 %>
							<% end %>        
						<% end %>
					</ul>
				</section>
			<% end %>    
		<% end %>
	</article>
</main>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

<script>
	function activate_modal(id) {
		var s = document.getElementById(id);
	    s.style.display = "block";
	}

	function deactivate_modal(id) {
		var s = document.getElementById(id);
	    s.style.display = "none";
	}
</script>