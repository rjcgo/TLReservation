<main class="wrapper" id="sidenav-container">
	<% if @testlines.length == 0 %>
		<div class="notice-wrapper">
			<h4>There are no test lines yet.</h4>
		</div>
	<% else %>
		<%= render partial: "sidenav", :locals => {testlines: @testlines} %>
		<section id="reservations">
			<article class="tabcontent" style="display: block;">
				<header>
					<%= render partial: "header", :locals => header("") %>
					<%= link_to reservations_download_log_file_path, :class => "download-link", target: :_blank do %>
						<i class="fa fa-download"></i> Download log file
					<% end %>
				</header>
				<h2 class="pick-testline">
					<i class="fa fa-hand-o-left"></i> Pick a Testline.</h2>
			</article>
			<% @testlines.each do |testline| %>
				<article id="tl-<%= testline.id %>" class="tabcontent" style="display: none;">
					<header>
						<%= render partial: "header", :locals => header(testline.name) %>
						<%= link_to reservations_download_log_file_path, :class => "download-link", target: :_blank do %>
							<i class="fa fa-download"></i> Download log file
						<% end %>
					</header>
					<% if testline.isMaintenance %>
						<div class="notice-wrapper bg-yellow">
							<h4>This test line is under maintenance</h4>
						</div>
					<% else %>
						<% if testline.reservations.length == 0 %>
							<div class="notice-wrapper">
								<h4>This test line is currently not in use.</h4>
							</div>
						<% else %>
						<div style="text-align: center; clear: both;">
							<%= link_to reserveText(testline), new_testline_reservation_path(testline), 
								remote: true, class: "card-link"%>
						</div>
							<ul class="list-group">
								<% testline.reservations.each_with_index do |reserve, index| %>
									<% orderProps = reservationOrder(index) %>
									<li class="list-item list-item-<%= orderProps['class'] %>">
										<small class="badge badge-<%= orderProps['class'] %>">
											<i class="fa <%= orderProps['icon'] %>"></i> 
											<%= orderProps['text'] %></small>
										<div class="list-item-header">
											<h3 class="title"><%= reserve.name %></h3>
											<small class="timestamp"><%= reserve.created_at %></small>
											<p class="subtitle"><%= reserve.team.name %></p>
										</div>
										<p class="description"><%= reserve.description %></p>
										<div class="list-item-footer">
											<small class="user">Reserved by <%= reserve.user.email %></small>
											<% if index == 0 %>
												<div class="time-used">
													<i class="fa fa-clock-o"></i> <span id="tm-<%= testline.id %>"></span>
												</div>
											<% end %>
										</div>
										<% if current_user.isAdmin? || (current_user.email == reserve.user.email)%>
											<%= link_to testline_reservation_path(testline, reserve), 
												remote: true, :method => :delete, 
												data: {confirm: "Are you sure you want to release your reservation?"}, 
												:class => 'release' do %><i class="fa fa-times"></i> Release
											<% end %>
										<% end %>
									</li>
								<% end %>
							</ul>
						<% end %>
						<div style="text-align: center; margin: 20px 0;">
							<%= link_to reserveText(testline), new_testline_reservation_path(testline), 
								remote: true, class: "card-link"%>
						</div>
					<% end %>
				</article>
			<% end %>
		</section>
	<% end %>
</main>
<div id="confirmationDialog" class="modal"></div>

<%= render "modal" %>
<script type="text/javascript">
	var t = new Object();
	var pt =  Math.floor(new Date().getTime() / 1000);

	<%= timer_script @testlines %>

	var timers = Object.keys(t);
	startTime();
</script>