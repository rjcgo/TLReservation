<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script src="home.js"></script>
<style>
	/* The Modal (background) */
	.modal {
	    display: none; /* Hidden by default */
	    position: fixed; /* Stay in place */
	    z-index: 1; /* Sit on top */
	    padding-top: 100px; /* Location of the box */
	    left: 0;
	    top: 0;
	    width: 100%; /* Full width */
	    height: 100%; /* Full height */
	    overflow: auto; /* Enable scroll if needed */
	    background-color: rgb(0,0,0); /* Fallback color */
	    background-color: rgba(0,0,0,0.4); /* Black w/ opacity */
	}

	/* Modal Content */
	.modal-content {
	    position: relative;
	    background-color: #fefefe;
	    margin: auto;
	    -webkit-animation-name: animatetop;
	    -webkit-animation-duration: 0.4s;
	    animation-name: animatetop;
	    animation-duration: 0.4s
	}

	/* Add Animation */
	@-webkit-keyframes animatetop {
	    from {top:-300px; opacity:0} 
	    to {top:0; opacity:1}
	}

	@keyframes animatetop {
	    from {top:-300px; opacity:0}
	    to {top:0; opacity:1}
	}

	/* The Close Button */
	.close {
	    color: black;
	    float: right;
	    font-size: 28px;
	    font-weight: bold;
	}

	.close:hover,
	.close:focus {
	    color: #ccc;
	    text-decoration: none;
	    cursor: pointer;
	}
	.modal-header {
	    padding: 2px 16px;
	}

	.modal-body {padding: 2px 16px;}
</style>
<script>
	function activate_modal(id) {
		var s = document.getElementById(id);
	    s.style.display = "block";
	}

	function deactivate_modal(id) {
		var s = document.getElementById(id);
	    s.style.display = "none";
	}
</script>

<% if user_signed_in? && current_user.isAdmin? %>
	<main class="wrapper">
		<article>
			<%= render partial: 'sidenav', :locals => {:sect => "testlines"} %>
			<section id="testlines" class="tabcontent">
				<div class="tabcontent-header">
					<h2 id="testlines-label"><i class="fa fa-server sidenav-toggle"></i> Testlines</h2>
					<h2 id="add-testline" style="cursor: pointer;"><i class="fa fa-plus"></i><%= content_tag :a, ' New Testline', :class=> "new-testline-link", :onclick => "activate_modal(0)" %></h2>
				</div>
				<% if @testlines.empty? %>
					<div class="wrappergreeting-">
						<div class="alert alert-success alert-dismissible" role="alert">
						  	<h4 class="alert-heading">There are no testlines yet.</h4>
						</div>
					</div>
				<% end %>

				<% if !notice.blank? %>
					<div class="wrapper-greeting">
						<div class="alert" role="alert" id="notice">
							<h4 class="alert-heading"><%= notice %></h4>
							</div>
					</div>
				<% end %>
				
				<div class="card-deck card-deck-special"> 	 
					<% @testlines.each do |testline| %>
						<%= content_tag :div, :class => "modal", :id => testline.id do -%>
							<div class="container reservation-form">  
								<div class="modal-content">
									<%= form_for(testline, :html => {:class => "reserve"}) do |f| %>
										<div class="modal-header">
											<%= content_tag :span, 'x', :class => "close", :onclick => "deactivate_modal(#{testline.id})" %>
											<h3>Edit testline</h3>
										</div>
										<fieldset>
											<%= f.text_field :name, :placeholder => "Name", :tabindex => "1", :required => "required" %>
										</fieldset>

										<fieldset>
											<%= f.text_field :ip_address, :placeholder => "IP Address", :tabindex => "2", :required => "required" %>
										</fieldset>

										<fieldset>
											<%= f.text_field :port_number, :placeholder => "Port Number", :tabindex => "3", :required => "required" %>
										</fieldset>
										<fieldset>
											<p>Under Maintenance?
												<%= f.check_box :isMaintenance, :tabindex => "4" %>
											</p>
										</fieldset>
										<fieldset>
											<button name="submit" type="submit" id="contact-submit" data-submit="...Sending">Save</button>
										</fieldset>
									<% end %>
								</div>
							</div>
						<% end %>

						<div class="modal-as" id="-<%= testline.id %>">
							<div class="modal-content-as" style="max-width: 400px;">
								<div class="modal-header-as bg-red">
									<h4 class="modal-title-as"><i class="fa fa-trash"></i> Delete</h4>
									<button type="button" class="modal-close-as bg-red" onclick="deactivate_modal(-<%= testline.id %>)">&times;</button>
								</div>
								<div class="modal-body-as">
									<p class="modal-text">Are you sure you want to delete <%= testline.name %>?</p>
								</div>
								<div class="modal-footer-as">
									<%= link_to 'Delete', testline, method: :delete, :class => "modal-btn-as bg-red" %>
									<button type="button" class="modal-btn-as" onclick="deactivate_modal(-<%= testline.id %>)">Cancel</button>
								</div>
							</div>
						</div>

						<div class="card">
							<% if ( testline.reservations.count !=0) && !testline.isMaintenance? %>
								<div class="card-header bg-red">
							<% elsif testline.isMaintenance? %>
								<div class="card-header bg-yellow">
							<% else %>
								<div class="card-header bg-green">	
							<% end %>
								<i class="fa fa-server fa-white icon-lg"></i>
		                        <h3><%= testline.name %></h3>
		                    </div>

		                    <div class="card-content">
		                    	<div class="card-title-admin">
									<h3 class="card-text"><%= testline.ip_address %>:<%= testline.port_number %></h3>
									<%= content_tag :button, 'Edit', :onclick => "activate_modal(#{testline.id})", :class => "card-btn-admin" %>
									<%= content_tag :button, 'Delete', :onclick => "activate_modal(-#{testline.id})", :class => "card-btn-admin" %>
		                          </div>		                       
							</div>
						</div>
					<% end %>
				</div>
			</section>
		</article>
		<%= content_tag :div, :class => "modal", :id => "0" do -%>
			<div class="container reservation-form">  
				<div class="modal-content">
					<%= form_for(@testline, :html => {:class => "reserve"}) do |f| %>
						<div class="modal-header">
							<%= content_tag :span, 'x', :class => "close", :onclick => "deactivate_modal(0)" %>
							<h3>Add new testline</h3>
						</div>
						<fieldset>
							<%= f.text_field :name, :placeholder => "Name", :tabindex => "1", :required => "required" %>
						</fieldset>

						<fieldset>
							<%= f.text_field :ip_address, :placeholder => "IP Address", :tabindex => "2", :required => "required" %>
						</fieldset>

						<fieldset>
							<%= f.text_field :port_number, :placeholder => "Port Number", :tabindex => "3", :required => "required" %>
						</fieldset>
						<fieldset>
							<p>Under Maintenance?
								<%= f.check_box :isMaintenance, :tabindex => "4" %>
							</p>
						</fieldset>
						<fieldset>
							<button name="submit" type="submit" id="contact-submit" data-submit="...Sending">Add testline</button>
						</fieldset>
					<% end %>
				</div>
			</div>
		<% end %>
	</main>
<% else %>
	<%= render 'error' %>
<% end %>