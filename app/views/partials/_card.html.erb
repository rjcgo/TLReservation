<div class="card">
    <div class="card-content">
        <!-- Card header -->
        <div class="card-header bg-blue">
            <div class="status-circle <%= color %>">
                <i class="fa <%= icon %> fa-white"></i>
            </div>
            <i class="fa fa-server testline-icon text-white"></i>
            <div class="card-header-overlay">
                <h3 class="card-title"><%= testline.name %></h3>
                <a href="#" class="card-header-link modal-open" data-diagram="<%= testline.diagram %>"
                    data-target="#img-modal">Show Diagram</a><br>
                <a href="#" class="card-header-link modal-open" data-content="<%= testline.description %>"
                    data-target="#desc-modal">Show Description</a>
            </div>
            <% if !testline.reservations.empty? %>
                <div class="timer">
                    <i class="fa fa-clock-o"></i> <span id="tm-<%= testline.id %>"></span>
                </div>
            <% end %>
        </div>
        <!-- Card body -->
        <div class="card-body">
            <% if request.original_fullpath == "/admin/associations" %>
                <% if testline.teams.empty? %>
                    <p style="text-align: center; margin: 10px;">No team can currently use this testline.</p>
                <% else %>
                    <div class="outer-border-hidden">
                        <ul class="pokeballs-grid pokeballs-grid-sm">
                            <% testline.teams.each do |team| %>
                                <li>
                                    <button type="button" class="release modal-open" 
                                        data-href="<%= testline_team_path(testline.id, team.id) %>"
                                        data-target="#confirm-modal" data-method="delete">
                                        <i class="fa fa-times"></i></button>
                                    <span class="<%= pokelist[team.id % 20] %>"></span><%= team.name %>
                                </li>
                            <% end %>
                        </ul>
                    </div>
                <% end %>
            <% elsif !testline.reservations.empty? %>
                <ul>
                    <% testline.reservations.each_with_index do |reservation, index| %>
                    <li>
                        <% orderProps = reservationOrder(index) %>
                        <p class="card-text"><%= reservation.name %></p>
                        <small class="badge badge-<%= orderProps['class'] %>">
                            <i class="fa <%= orderProps['icon'] %>"></i> 
                            <%= orderProps['text'] %></small>
                        <span class="delete-overlay">
                            <i class="fa fa-calendar-check-o"></i> 
                            <%= reservation.user.email %>
                        </span>
                    </li>
                    <% end %>
                </ul>
            <% else %>
                <p style="text-align: center; margin: 10px;">There are currently no reservations for this testline.</p>
            <% end %>
        </div>
        <!-- Card footer -->
        <div class="card-footer">
            <% if request.original_fullpath == "/admin/testlines" %>
                <a href="javascript:void(0)" class="card-link modal-open" 
                    data-href="<%= testline_path(testline) %>"
                    data-testline="<%= testline.to_json %>" data-target="#testline-modal" 
                    data-method="put">Edit Testline</a>
                <a href="javascript:void(0)" class="card-link text-red modal-open" 
                    data-href="<%= url_for(testline) %>"
                    data-target="#confirm-modal" data-method="delete">Delete</a>
            <% elsif request.original_fullpath == "/admin/associations" %>
                <a href="javascript:void(0)" class="card-link modal-open" 
                    data-teams="<%= teams_without_access(testline).to_json(:only => [:id, :name]) %>" 
                    data-href="<%= testline_teams_path(testline.id) %>" data-target="#rel-modal" 
                    data-method="post"><i class="fa fa-plus"></i> Add Team</a>
            <% elsif testline.isMaintenance %>
                <p style="text-align: center; margin: 10px;">This testline is under maintenance.</p>
            <% elsif !(userReservation = didReserveTestline(testline)).nil? %>
                <a href="javascript:void(0)" class="card-link text-red modal-open" 
                    data-href="<%= url_for([testline, userReservation]) %>"
                    data-target="#confirm-modal" data-method="delete">Release</a>
            <% else %>
                <a href="javascript:void(0)" class="card-link modal-open"
                    data-href="<%= testline_reservations_path(testline.id) %>" 
                    data-teams="<%= @team.to_json(:only => [:id, :name]) %>" 
                    data-email="<%= current_user.email %>" data-target="#reserve-modal" 
                    data-method="post"><%= reserveText(testline) %></a>
            <% end %>
        </div>
    </div>
</div>